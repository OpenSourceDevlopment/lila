@(email: Option[lidraughts.common.EmailAddress], stripePublicKey: String, patron: Option[lidraughts.plan.Patron], recentIds: List[String], bestIds: List[String])(implicit ctx: Context)

@title = @{"Become a Patron of lidraughts.org"}

@moreJs = {
<script src="https://checkout.stripe.com/checkout.js"></script>
@jsTag("checkout.js")
@embedJs {
lidraughts.checkout("@stripePublicKey");
}
}

@base.layout(
title = title,
moreCss = responsiveCssTag("plan"),
moreJs = moreJs,
responsive = true,
openGraph = lidraughts.app.ui.OpenGraph(
title = title,
url = s"$netBaseUrl${routes.Plan.index.url}",
description = "Free draughts for everyone, forever!").some,
csp = defaultCsp.withStripe.some) {
<main class="page-menu plan">
  <aside class="page-menu__menu recent_patrons">
    <h2>New Patrons</h2>
    <div class="list">
      @recentIds.map { userId =>
      <div>@userIdLink(userId.some).toHtml</div>
      }
    </div>
  </aside>
  <div class="page-menu__content box">
    @patron.ifTrue(ctx.me.??(_.isPatron)).map { p =>
    <div class="banner one_time_active">
      <i data-icon="@patronIconChar"></i>
      <div>
        <h1>Thank you for your donation!</h1>
        @if(p.isLifetime) {
        You have a <strong>Lifetime Patron</strong> account. That's pretty awesome!
        } else {
        @p.expiresAt.map { expires =>
        You have a Patron account until @showDate(expires).<br />
        If not renewed, you will then be downgraded to free.
        }
        }
      </div>
      <i data-icon="@patronIconChar"></i>
    </div>
    }.getOrElse {
    <div class="banner moto">
      <i data-icon="@patronIconChar"></i>
      <div>
        <h1>Free draughts for everyone, forever!</h1>
        <p>No ads, no subscriptions; but open source and passion.</p>
      </div>
      <i data-icon="@patronIconChar"></i>
    </div>
    }
    <div class="box__pad">
      <div class="wrapper">
        <div class="text">
          <p>
            We are a small team of volunteers who believe in a free,
            world-class draughts experience for anyone, anywhere.
          </p>
          <p>
            We rely on support from people like you to make it possible.
            If you've gotten something out of Lidraughts, please take a second to pitch in!
          </p>
        </div>
        <div class="content">

          <div class="plan_checkout" data-email="@email" data-lifetime-usd="@lidraughts.plan.Cents.lifetime.usd" data-lifetime-cents="@lidraughts.plan.Cents.lifetime.value">
            @*<form class="stripe_checkout none" action="@routes.Plan.charge" method="POST">
              <input type="hidden" class="token" name="token" />
              <input type="hidden" class="email" name="email" />
              <input type="hidden" class="amount" name="amount" />
              <input type="hidden" class="freq" name="freq" />
            </form>*@
            <form class="paypal_checkout onetime none" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
              <input type="hidden" name="custom" value="@ctx.userId">
              <input type="hidden" name="amount" class="amount" value="">
              <input type="hidden" name="cmd" value="_xclick">
              <input type="hidden" name="business" value="EWNKNKK58PMS6">
              <input type="hidden" name="item_name" value="lidraughts.org one-time">
              <input type="hidden" name="button_subtype" value="services">
              <input type="hidden" name="no_note" value="1">
              <input type="hidden" name="no_shipping" value="1">
              <input type="hidden" name="rm" value="1">
              <input type="hidden" name="return" value="@netBaseUrl/patron/thanks">
              <input type="hidden" name="cancel_return" value="@netBaseUrl/patron">
              <input type="hidden" name="lc" value="US">
              <input type="hidden" name="currency_code" value="EUR">
            </form>
            <form class="paypal_checkout monthly none" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
              <input type="hidden" name="custom" value="@ctx.userId">
              <input type="hidden" name="a3" class="amount" value="">
              <input type="hidden" name="cmd" value="_xclick-subscriptions">
              <input type="hidden" name="business" value="EWNKNKK58PMS6">
              <input type="hidden" name="item_name" value="lidraughts.org monthly">
              <input type="hidden" name="no_note" value="1">
              <input type="hidden" name="no_shipping" value="1">
              <input type="hidden" name="rm" value="1">
              <input type="hidden" name="return" value="@netBaseUrl/patron/thanks">
              <input type="hidden" name="cancel_return" value="@netBaseUrl/patron">
              <input type="hidden" name="src" value="1">
              <input type="hidden" name="p3" value="1">
              <input type="hidden" name="t3" value="M">
              <input type="hidden" name="lc" value="US">
              <input type="hidden" name="currency_code" value="EUR">
            </form>
            <form class="paypal_checkout lifetime none" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
              <input type="hidden" name="custom" value="@ctx.userId">
              <input type="hidden" name="amount" class="amount" value="">
              <input type="hidden" name="cmd" value="_xclick">
              <input type="hidden" name="business" value="EWNKNKK58PMS6">
              <input type="hidden" name="item_name" value="lidraughts.org lifetime">
              <input type="hidden" name="button_subtype" value="services">
              <input type="hidden" name="no_note" value="1">
              <input type="hidden" name="no_shipping" value="1">
              <input type="hidden" name="rm" value="1">
              <input type="hidden" name="return" value="@netBaseUrl/patron/thanks">
              <input type="hidden" name="cancel_return" value="@netBaseUrl/patron">
              <input type="hidden" name="lc" value="US">
              <input type="hidden" name="currency_code" value="EUR">
            </form>

            @if(patron.exists(_.isLifetime)) { <p style="text-align:center;margin-bottom:1em">Make an extra donation?</p>  }

            <group class="radio buttons freq">
              @defining(s"Pay ${lidraughts.plan.Cents.lifetime.usd} once. Be a Lidraughts Patron forever!") { info =>
              <div title="@info" class="@if(patron.exists(_.isLifetime)){ lifetime-check}">
                <input type="radio" name="freq" id="freq_lifetime" @if(patron.exists(_.isLifetime)){disabled} value="lifetime" />
                <label for="freq_lifetime">Lifetime</label>
              </div>
              }
              @defining("Recurring billing, renewing your Patron Wings every month.") { info =>
              <div title="@info">
                <input type="radio" name="freq" id="freq_monthly" value="monthly" />
                <label for="freq_monthly">Monthly</label>
              </div>
              }
              @defining("A single donation that grants you the Patron Wings for one month.") { info =>
              <div title="@info">
                <input type="radio" name="freq" id="freq_onetime" checked value="onetime" />
                <label for="freq_onetime">One-time</label>
              </div>
              }
            </group>
            <div class="amount_choice">
              <group class="radio buttons amount">
                @lidraughts.plan.StripePlan.defaultAmounts.map { cents =>
                @defining(s"plan_${cents.value}") { id =>
                <div>
                  <input type="radio" name="plan"
                  id="plan_@cents.value"
                  @if(cents.usd.value == 10) { checked }
                  value="@cents.value"
                  data-usd="@cents.usd"
                  data-amount="@cents.value" />
                  <label for="plan_@cents.value">@cents.usd</label>
                </div>
                }
                }
                <div class="other">
                  <input type="radio" name="plan"
                  id="plan_other"
                  value="other" />
                  <label for="plan_other">Other</label>
                </div>
              </group>
            </div>
            <div class="amount_fixed none">
              <group class="radio buttons amount">
                <div>
                  @defining(lidraughts.plan.Cents.lifetime) { cents =>
                  <label for="plan_@cents.value">@cents.usd</label>
                  }
                </div>
              </group>
            </div>
            <div class="service">
              @*<button class="stripe button">Credit Card</button>*@
              <button class="paypal button">Donate with PayPal</button>
            </div>
          </div>
        </div>
      </div>
      <p class="small_team">
        We are a small team, so your support makes a huge difference!
      </p>
      <div class="faq">
        <dl>
          <dt>Where does the money go?</dt>
          <dd>
            The servers that run lidraughts and the Scan engine analysis. Other operating costs such as mailgun and hosting.<br />
            Possibly we can have titled tournaments with real money prizes at some point in the future!
          </dd>
        </dl>
        <dl>
          <dt>Can I change/cancel my monthly support?</dt>
          <dd>
            Yes, at any time. Login to your PayPal account and go to your automatic payments overview.<br />
            Or you can <a href="@routes.Page.contact" target="_blank">contact Lidraughts support</a>.
          </dd>
          <dt>Other methods of donation?</dt>
          <dd>
            We also accept bank transfers. Please send an e-mail to @contactEmailLink for details.<br />
          </dd>
        </dl>
        <dl>
          <dt>Are some features reserved to Patrons?</dt>
          <dd>
            <a href="@routes.Plan.features" target="_blank">No</a>, because
            Lidraughts is entirely free, forever, and for everyone. That's a promise.<br />
            But Patrons get bragging rights with a cool new profile icon.<br />
            See the <a href="@routes.Plan.features" target="_blank">detailed features comparison</a>.
          </dd>
        </dl>
      </div>
      <div class="best_patrons">
        <h2>The celebrated Patrons who make Lidraughts possible</h2>
        <div class="list">
          @bestIds.map { userId =>
          <div>
            @userIdLink(userId.some).toHtml
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</main>
}.toHtml
